testcafe_tests:
  stage: test
  image: almalinux:8.6-20220512
  before_script:
    # Install dependencies
    - dnf -y install wget zip jq openssl procps epel-release python3
    - dnf -y groupinstall "Development Tools"
    # Install Chrome
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
    - dnf -y install google-chrome-stable_current_x86_64.rpm
    # install node 16.17.1
    - curl -sL https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.0/install.sh | bash - && \
    - source /root/.nvm/nvm.sh && \
    - nvm install 18.16.0 && \
    - nvm alias default 18.16.0 && \
    - nvm use default

    # install latest versions of npm and node-gyp
    - npm install -g npm
    - npm install -g node-gyp

    # Install yarn
    - npm install -g yarn
  script:
    - yarn install
    - yarn testcafe chrome:headless tests/sampleTest.ts -e
  artifacts:
    paths:
      - sampleyarn/tests/screenshots/*
    when: on_failure
    expire_in: 5 days
